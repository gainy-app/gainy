{
  "name": "meltano-airflow-scheduler",
  "cpu": ${airflow_scheduler_cpu_credits},
  "memory": ${airflow_scheduler_memory_credits},
  "extraHosts": null,
  "dnsServers": null,
  "disableNetworking": null,
  "dnsSearchDomains": null,
  "portMappings": [],
  "hostname": null,
  "essential": true,
  "entryPoint": ["/init.sh"],
  "mountPoints": [
    {
      "containerPath" : "/project/.meltano/run/airflow",
      "sourceVolume" : "meltano-data"
    },
    {
      "containerPath" : "/project/.meltano/run/airflow/logs",
      "sourceVolume" : "meltano-logs"
    }
  ],
  "ulimits": null,
  "dockerSecurityOptions": null,
  "environment": [
    { "name": "ENV",                                   "value": "${env}" },
    { "name": "AWS_ACCESS_KEY_ID",                     "value": "${aws_access_key}" },
    { "name": "AWS_SECRET_ACCESS_KEY",                 "value": "${aws_secret_key}" },
    { "name": "AWS_DEFAULT_REGION",                    "value": "${aws_region}" },
    { "name": "PG_DBNAME",                             "value": "${pg_dbname}" },
    { "name": "PG_HOST",                               "value": "${pg_host}" },
    { "name": "PG_PASSWORD",                           "value": "${pg_password}" },
    { "name": "PG_PORT",                               "value": "${pg_port}" },
    { "name": "PG_USERNAME",                           "value": "${pg_username}" },
    { "name": "PG_DATADOG_PASSWORD",                   "value": "${pg_datadog_password}" },
    { "name": "PG_INTERNAL_SYNC_USERNAME",             "value": "${pg_internal_sync_username}" },
    { "name": "PG_INTERNAL_SYNC_PASSWORD",             "value": "${pg_internal_sync_password}" },
    { "name": "MELTANO_DATABASE_URI",                  "value": "postgresql://${pg_username}:${pg_password}@${pg_host}:${pg_port}/${pg_dbname}?options=-csearch_path=${pg_meltano_schema}" },
    { "name": "MELTANO_LOG_LEVEL",                     "value": "warning" },
    { "name": "MELTANO_ELT_BUFFER_SIZE",               "value": "314572800" },
    { "name": "AIRFLOW_PASSWORD",                      "value": "${airflow_password}" },
    { "name": "AIRFLOW_DATABASE_URI",                  "value": "postgresql://${pg_username}:${pg_password}@${pg_host}:${pg_port}/${pg_dbname}?options=-csearch_path=${pg_airflow_schema}" },
    { "name": "AIRFLOW_LOG_LEVEL",                     "value": "INFO" },
    { "name": "UPSTREAM_POOL_SIZE",                    "value": "${upstream_pool_size}" },
    { "name": "DOWNSTREAM_POOL_SIZE",                  "value": "${downstream_pool_size}" },
    { "name": "EODHISTORICALDATA_JOBS_COUNT",          "value": "${eodhistoricaldata_jobs_count}" },
    { "name": "EODHISTORICALDATA_PRICES_JOBS_COUNT",   "value": "${eodhistoricaldata_prices_jobs_count}" },
    { "name": "COINGECKO_JOBS_COUNT",                  "value": "${coingecko_jobs_count}" },
    { "name": "POLYGON_JOBS_COUNT",                    "value": "${polygon_jobs_count}" },
    { "name": "TAP_EODHISTORICALDATA_API_TOKEN",       "value": "${eodhistoricaldata_api_token}" },
    { "name": "TAP_EODHISTORICALDATA_EXCHANGES",       "value": ${jsonencode(eodhistoricaldata_exchanges)} },
    { "name": "TAP_POLYGON_API_KEY",                   "value": "${polygon_api_token}" },
    { "name": "TAP_POLYGON_CRYPTO_SYMBOLS",            "value": ${jsonencode(polygon_crypto_symbols)} },
    { "name": "TAP_POLYGON_STOCK_EXCHANGES",           "value": ${jsonencode(polygon_stock_exchanges)} },
    { "name": "TAP_COINGECKO_API_KEY",                 "value": "${coingecko_api_key}" },
    { "name": "AWS_LAMBDA_API_GATEWAY_ENDPOINT",       "value": "${aws_lambda_api_gateway_endpoint}" },
    { "name": "TARGET_S3_CSV_HISTORY_S3_BUCKET",       "value": "${gainy_history_s3_bucket}" },
    { "name": "GITHUB_APP_ID",                         "value": "${github_app_id}" },
    { "name": "GITHUB_APP_INSTALLATION_ID",            "value": "${github_app_installation_id}" },
    { "name": "GITHUB_APP_PRIVATE_KEY",                "value": ${jsonencode(github_app_private_key)} },

    { "name": "TARGET_POSTGRES_HOST",                  "value": "${pg_host}" },
    { "name": "TARGET_POSTGRES_PORT",                  "value": "${pg_port}" },
    { "name": "TARGET_POSTGRES_USER",                  "value": "${pg_username}" },
    { "name": "TARGET_POSTGRES_PASSWORD",              "value": "${pg_password}" },
    { "name": "TARGET_POSTGRES_DBNAME",                "value": "${pg_dbname}" },
    { "name": "TARGET_POSTGRES_SCHEMA",                "value": "${pg_load_schema}" },

    { "name": "TARGET_POSTGRES_ANALYTICS_HOST",        "value": "${pg_external_access_host}" },
    { "name": "TARGET_POSTGRES_ANALYTICS_PORT",        "value": "${pg_external_access_port}" },
    { "name": "TARGET_POSTGRES_ANALYTICS_USER",        "value": "${pg_external_access_username}" },
    { "name": "TARGET_POSTGRES_ANALYTICS_PASSWORD",    "value": "${pg_external_access_password}" },
    { "name": "TARGET_POSTGRES_ANALYTICS_DBNAME",      "value": "${pg_external_access_dbname}" },
    { "name": "TARGET_POSTGRES_ANALYTICS_SCHEMA",      "value": "${pg_analytics_schema}" },

    { "name": "TAP_POSTGRES_WEBSITE_HOST",             "value": "${pg_external_access_host}" },
    { "name": "TAP_POSTGRES_WEBSITE_PORT",             "value": "${pg_external_access_port}" },
    { "name": "TAP_POSTGRES_WEBSITE_USER",             "value": "${pg_external_access_username}" },
    { "name": "TAP_POSTGRES_WEBSITE_PASSWORD",         "value": "${pg_external_access_password}" },
    { "name": "TAP_POSTGRES_WEBSITE_DBNAME",           "value": "${pg_external_access_dbname}" },
    { "name": "TAP_POSTGRES_WEBSITE_SCHEMA",           "value": "${pg_website_schema}" },

    { "name": "TAP_POSTGRES_HOST",                     "value": "${pg_host}" },
    { "name": "TAP_POSTGRES_PORT",                     "value": "${pg_port}" },
    { "name": "TAP_POSTGRES_USER",                     "value": "${pg_username}" },
    { "name": "TAP_POSTGRES_PASSWORD",                 "value": "${pg_password}" },
    { "name": "TAP_POSTGRES_DBNAME",                   "value": "${pg_dbname}" },
    { "name": "TAP_POSTGRES_FILTER_SCHEMAS",           "value": "${pg_transform_schema}" },

    { "name": "TAP_POSTGRES_SYNC_HOST",                "value": "${pg_production_host}" },
    { "name": "TAP_POSTGRES_SYNC_PORT",                "value": "${pg_production_port}" },
    { "name": "TAP_POSTGRES_SYNC_USER",                "value": "${pg_production_internal_sync_username}" },
    { "name": "TAP_POSTGRES_SYNC_PASSWORD",            "value": "${pg_production_internal_sync_password}" },
    { "name": "TAP_POSTGRES_SYNC_DBNAME",              "value": "${pg_dbname}" },
    { "name": "TAP_POSTGRES_SYNC_FILTER_SCHEMAS",      "value": "${pg_load_schema}" },

    { "name": "TAP_POSTGRES_ANALYTICS_FILTER_SCHEMAS", "value": "app,raw_data,${pg_transform_schema}" },
    { "name": "TAP_POSTGRES_HISTORY_FILTER_SCHEMAS",   "value": "app,${pg_transform_schema}" },

    { "name": "TARGET_BIGQUERY_DEFAULT_TARGET_SCHEMA", "value": "${bigquery_target_schema}" },
    { "name": "TARGET_BIGQUERY_LOCATION",              "value": "${bigquery_location}" },
    { "name": "BIGQUERY_PROJECT_ID",                   "value": "${bigquery_google_project}" },
    { "name": "BIGQUERY_CREDENTIALS",                  "value": ${jsonencode(bigquery_credentials)} },
    { "name": "TAP_BIGQUERY_STREAMS",                  "value": ${jsonencode(jsonencode([{"columns": ["*"], "datetime_key": "updated_at", "name": "stats_ttf_clicks", "table": "${bigquery_google_project}.analytics_287066082.stats_ttf_clicks"}]))} },

    { "name": "DBT_THREADS",                           "value": "${dbt_threads}" },
    { "name": "DBT_TARGET_SCHEMA",                     "value": "${pg_transform_schema}" },
    { "name": "DBT_TARGET",                            "value": "postgres" },
    { "name": "DBT_ARTIFACT_STATE_PATH",               "value": "/project/.meltano/transformers/dbt/target/" },

    { "name": "ALGOLIA_APP_ID",                        "value": "${algolia_app_id}" },
    { "name": "ALGOLIA_TICKERS_INDEX",                 "value": "${algolia_tickers_index}" },
    { "name": "ALGOLIA_COLLECTIONS_INDEX",             "value": "${algolia_collections_index}" },
    { "name": "ALGOLIA_INDEXING_API_KEY",              "value": "${algolia_indexing_key}" },

    { "name": "ONESIGNAL_APP_ID",                      "value": "${onesignal_app_id}" },
    { "name": "ONESIGNAL_API_KEY",                     "value": "${onesignal_api_key}" },
    { "name": "ONESIGNAL_SEGMENTS_PRODUCTION",         "value": ${jsonencode(onesignal_segments_production)} },
    { "name": "ONESIGNAL_SEGMENTS_TEST",               "value": ${jsonencode(onesignal_segments_test)} },

    { "name": "DATADOG_API_KEY",                       "value": "${datadog_api_key}" },
    { "name": "DATADOG_APP_KEY",                       "value": "${datadog_app_key}" },

    { "name": "DRIVEWEALTH_IS_UAT",                    "value": "${drivewealth_is_uat}" },
    { "name": "DRIVEWEALTH_APP_KEY",                   "value": "${drivewealth_app_key}" },
    { "name": "DRIVEWEALTH_WLP_ID",                    "value": "${drivewealth_wlp_id}" },
    { "name": "DRIVEWEALTH_PARENT_IBID",               "value": "${drivewealth_parent_ibid}" },
    { "name": "DRIVEWEALTH_RIA_ID",                    "value": "${drivewealth_ria_id}" },
    { "name": "DRIVEWEALTH_RIA_PRODUCT_ID",            "value": "${drivewealth_ria_product_id}" },
    { "name": "DRIVEWEALTH_API_USERNAME",              "value": "${drivewealth_api_username}" },
    { "name": "DRIVEWEALTH_API_PASSWORD",              "value": "${drivewealth_api_password}" },
    { "name": "DRIVEWEALTH_API_URL",                   "value": "${drivewealth_api_url}" },

    { "name": "PLAID_CLIENT_ID",                       "value": "${plaid_client_id}" },
    { "name": "PLAID_SECRET",                          "value": "${plaid_secret}" },
    { "name": "PLAID_DEVELOPMENT_SECRET",              "value": "${plaid_development_secret}" },
    { "name": "PLAID_SANDBOX_SECRET",                  "value": "${plaid_sandbox_secret}" },
    { "name": "PLAID_ENV",                             "value": "${plaid_env}" },

    { "name": "MLFLOW_ARTIFACT_LOCATION",              "value": "${mlflow_artifact_location}" },
    { "name": "MLFLOW_TRACKING_URI",                   "value": "postgresql://${pg_username}:${pg_password}@${pg_host}:${pg_port}/${pg_dbname}?options=-csearch_path=${pg_mlflow_schema}" }
  ],
  "links": [],
  "workingDirectory": null,
  "readonlyRootFilesystem": null,
  "image": "${meltano_image}",
  "command": ["invoke", "airflow", "scheduler"],
  "user": null,
  "dockerLabels": null,
  "privileged": null,
  "memoryReservation": null,
  "healthCheck": {
    "command": [ "CMD-SHELL", "nc -z localhost 8793" ],
    "interval": 10,
    "retries": 2
  },
  "logConfiguration": {
    "logDriver": "awslogs",
    "options": {
      "awslogs-group": "${aws_log_group_name}",
      "awslogs-region": "${aws_log_region}",
      "awslogs-stream-prefix": "meltano"
    }
  }
}
