{
  "name": "meltano-airflow-ui",
  "cpu": ${airflow_ui_cpu_credits},
  "memory": ${airflow_ui_memory_credits},
  "extraHosts": null,
  "dnsServers": null,
  "disableNetworking": null,
  "dnsSearchDomains": null,
  "portMappings": [
    {
      "hostPort": ${airflow_port},
      "containerPort": ${airflow_port},
      "protocol": "tcp"
    }
  ],
  "hostname": null,
  "essential": true,
  "entryPoint": ["/wait.sh"],
  "mountPoints": [
    {
      "containerPath" : "/project/.meltano/run/airflow",
      "sourceVolume" : "meltano-data"
    },
    {
      "containerPath" : "/project/.meltano/run/airflow/logs",
      "sourceVolume" : "meltano-logs"
    }
  ],
  "ulimits": null,
  "dockerSecurityOptions": null,
  "environment": [
    { "name": "ENV",                                 "value": "${env}" },
    { "name": "PG_DBNAME",                           "value": "${pg_dbname}" },
    { "name": "PG_HOST",                             "value": "${pg_host}" },
    { "name": "PG_PASSWORD",                         "value": "${pg_password}" },
    { "name": "PG_PORT",                             "value": "${pg_port}" },
    { "name": "PG_USERNAME",                         "value": "${pg_username}" },
    { "name": "MELTANO_DATABASE_URI",                "value": "postgresql://${pg_username}:${pg_password}@${pg_host}:${pg_port}/${pg_dbname}?options=-csearch_path=${pg_meltano_schema}" },
    { "name": "MELTANO_LOG_LEVEL",                   "value": "warning" },
    { "name": "AIRFLOW_PASSWORD",                    "value": "${airflow_password}" },
    { "name": "AIRFLOW_DATABASE_URI",                "value": "postgresql://${pg_username}:${pg_password}@${pg_host}:${pg_port}/${pg_dbname}?options=-csearch_path=${pg_airflow_schema}" },
    { "name": "AIRFLOW_LOG_LEVEL",                   "value": "WARNING" },
    { "name": "UPSTREAM_POOL_SIZE",                  "value": "${upstream_pool_size}" },
    { "name": "DOWNSTREAM_POOL_SIZE",                "value": "${downstream_pool_size}" },
    { "name": "EODHISTORICALDATA_JOBS_COUNT",        "value": "${eodhistoricaldata_jobs_count}" },
    { "name": "EODHISTORICALDATA_PRICES_JOBS_COUNT", "value": "${eodhistoricaldata_prices_jobs_count}" },
    { "name": "COINGECKO_JOBS_COUNT",                "value": "${coingecko_jobs_count}" },
    { "name": "POLYGON_JOBS_COUNT",                  "value": "${polygon_jobs_count}" },
    { "name": "DBT_TARGET_SCHEMA",                   "value": "${pg_transform_schema}" },
    { "name": "DBT_ARTIFACT_STATE_PATH",             "value": "/project/.meltano/transformers/dbt/target/" },
    { "name": "AWS_LAMBDA_API_GATEWAY_ENDPOINT",     "value": "${aws_lambda_api_gateway_endpoint}" }
  ],
  "links": [],
  "workingDirectory": null,
  "readonlyRootFilesystem": null,
  "image": "${meltano_image}",
  "command": ["invoke", "airflow", "webserver", "-p", "${airflow_port}"],
  "user": null,
  "dockerLabels": null,
  "privileged": null,
  "memoryReservation": null,
  "healthCheck": {
    "command": [ "CMD-SHELL", "curl http://localhost:5001/health | python -c 'import sys, json; data = json.load(sys.stdin); assert data[\"scheduler\"][\"status\"] == \"healthy\"; assert data[\"metadatabase\"][\"status\"] == \"healthy\"'" ],
    "interval": 10,
    "retries": 2
  },
  "logConfiguration": {
    "logDriver": "awslogs",
    "options": {
      "awslogs-group": "${aws_log_group_name}",
      "awslogs-region": "${aws_log_region}",
      "awslogs-stream-prefix": "meltano"
    }
  }
}